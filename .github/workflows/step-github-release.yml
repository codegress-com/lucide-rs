#
# GitHub Release Workflow
#
# This workflow creates GitHub releases with CLI binaries attached.
# It downloads all build artifacts and creates a release with generated notes.
#
# Triggered: Called by other workflows (workflow_call)
# Purpose: Create GitHub releases with downloadable CLI binaries
#

name: âš™ï¸ Create GitHub Release

on:
  # Allow this workflow to be called by other workflows
  workflow_call:
    inputs:
      tag_name:
        description: "Git tag name for the release"
        required: true
        type: string
      prerelease:
        description: "Mark this as a prerelease"
        required: false
        type: boolean
        default: false
      draft:
        description: "Create as draft release"
        required: false
        type: boolean
        default: false

# Permissions required for creating releases
permissions:
  contents: write # Required for creating GitHub releases

jobs:
  # Create GitHub release with artifacts
  create-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    permissions:
      contents: write # Required for creating releases
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.tag_name }}


      - name: Generate release notes
        id: release_notes
        run: |
          echo "ðŸ“ Generating release notes..."

          # Create release notes file
          cat > release-notes.md << EOF
          ## ðŸŽ‰ Lucide Rust ${{ inputs.tag_name }}

          This release includes the Lucide icon library for Rust UI frameworks.

          ### ðŸ“¥ Installation

          **Via Cargo:**
          \`\`\`bash
          cargo add lucide
          \`\`\`

          ### ðŸŽ¨ Supported Frameworks

          - **Dioxus** - RSX components
          - **Leptos** - Server-side rendering support
          - **Yew** - WebAssembly components
          - **Sycamore** - Reactive components

          ### ðŸš€ Quick Start

          \`\`\`rust
          use lucide::icons::Heart;

          // In your component
          Heart { size: 24, color: "red" }
          \`\`\`

          ### ðŸ”— Useful Links

          - ðŸ“š [Documentation](https://docs.rs/lucide)
          - ðŸŽ¨ [Lucide Icons](https://lucide.dev)
          - ðŸ’¬ [Discussions](https://github.com/codegress-com/lucide-rs/discussions)
          - ðŸ› [Report Issues](https://github.com/codegress-com/lucide-rs/issues)
          EOF

          echo "Release notes generated"

      - name: Create GitHub release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ inputs.tag_name }}
          draft: ${{ inputs.draft }}
          prerelease: ${{ inputs.prerelease }}
          generate_release_notes: true # Auto-generate from commits
          body_path: release-notes.md # Use our custom release notes
          # No binary assets for this library release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Release summary
        run: |
          echo "ðŸŽ‰ Lucide Rust release created successfully!"
          echo ""
          echo "ðŸ·ï¸ Tag: ${{ inputs.tag_name }}"
          echo "ðŸ”— Release URL: https://github.com/${{ github.repository }}/releases/tag/${{ inputs.tag_name }}"
          echo ""
          echo "ðŸ“¦ Library available via: cargo add lucide"
